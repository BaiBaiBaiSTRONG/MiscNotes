### æ•°æ®åº“ç¬¬ä¸€æ¬¡æ€»æ¦‚æ‹¬æ‘˜è®°ç‚¹

[TOC]



### ç®€å•SQLè¯­å¥

#### å»ºè¡¨

>ï¬charï¼ˆnï¼‰ ==å›ºå®šé•¿åº¦==çš„å­—ç¬¦ä¸²ï¼Œç”¨æˆ·æŒ‡å®šé•¿åº¦ä¸ºnã€‚
>ï¬varcharï¼ˆnï¼‰ ==å¯å˜é•¿åº¦==çš„å­—ç¬¦ä¸²ï¼Œç”¨æˆ·æŒ‡å®šçš„æœ€å¤§é•¿åº¦ä¸ºnã€‚
>ï¬int æ•´æ•°
>ï¬smallint  å°æ•´æ•°ï¼ˆæ•´æ•°åŸŸç±»å‹çš„æœºå™¨ç›¸å…³å­é›†ï¼‰ã€‚
>ï¬numericï¼ˆpï¼Œdï¼‰ å°æ•°ï¼Œç”¨æˆ·==ç²¾åº¦ä¸ºpä½ï¼Œå°æ•°ç‚¹å³è¾¹ä¸ºdä½==ã€‚==$\color{red}{SQLé‡Œé¢è¿™ä¸ªæ˜¯åˆ†å¼€çš„ï¼Œè¿™ä¸€éƒ¨åˆ†å•æŒ‡å°æ•°}$==
>ï¬real , double precision  æµ®ç‚¹æ•°å’ŒåŒç²¾åº¦æµ®ç‚¹æ•°ï¼Œå–å†³äºæœºå™¨ç²¾åº¦ã€‚
>ï¬floatï¼ˆnï¼‰ æµ®ç‚¹æ•°ï¼Œç”¨æˆ·æŒ‡å®šçš„==ç²¾åº¦è‡³å°‘ä¸ºnä½æ•°å­—==ã€‚
>ï¬date, time, timestamp, interval
>
>ï¬æ¯ä¸ªç±»å‹å¯èƒ½åŒ…å«ç§°ä¸ºç©ºå€¼çš„ç‰¹æ®Šå€¼

```sql
create table TableNameA(                    //è¿™é‡Œç”¨åœ†æ‹¬å·ï¼
	nameint int 
	namevarchar varchar(length) not null    //è¦æ±‚æŸä¸€é¡¹éç©ºï¼
	namenumeric numeric(p,d)
	namedate date
    primary key(KeyName1,KeyName2,Â·Â·Â· ,KeyNamen)
    foreign key(KeyName) references TableNameB
)
```

#### æ’å…¥

```sql
insert into TableNameA 
	(â€˜nameintâ€™, â€˜namevarcharâ€˜,â€˜namenumericâ€˜, namedate)
		//æ­¤å¤„çš„æ‹¬å·å¯ä»¥è‡ªå®šä¹‰æ’å…¥æ•°æ®çš„é¡ºåºï¼Œä¸‹é¢çš„è¦ä¸è¿™é‡Œä¸€è‡´
values(
	â€˜nameintâ€™,
    â€˜namevarcharâ€˜  check(Conditions) //å¯ä»¥ä»ä¸€å¼€å§‹è¿›è¡Œæ¡ä»¶æ€§ç­›é€‰
    â€˜namenumericâ€˜, //å­—ç¬¦è¦æ±‚ä½¿ç”¨å•å¼•å·æ¥æ’å…¥
    namedate	//æŒ‰ç…§ç›¸åŒçš„é¡ºåºï¼&& ä¸»ç ä¸Šæœ‰ç©ºå€¼æˆ–è€…é‡å¤ä¼šä¸æˆåŠŸ
ï¼‰
    
INSERT INTO TableName
VALUES (*value1*,*value2*,*value3*,...);
// ç¬¬ä¸€ç§å½¢å¼,æ— éœ€æŒ‡å®šè¦æ’å…¥æ•°æ®çš„åˆ—åï¼Œåªéœ€æä¾›è¢«æ’å…¥çš„å€¼å³å¯ï¼š
INSERT INTO TableName (*column1*,*column2*,*column3*,...)
VALUES (*value1*,*value2*,*value3*,...);
//ç¬¬äºŒç§å½¢å¼,éœ€è¦æŒ‡å®šåˆ—ååŠè¢«æ’å…¥çš„å€¼

```

ä¹Ÿå¯ä»¥ä¾ç…§`select`çš„ç»“æœæ¥æ’å…¥

```sql
insert into TableName
	select ï¼Œï¼Œï¼Œï¼Œ
	fromï¼Œï¼Œï¼Œ
	whereï¼Œï¼Œï¼Œ
```

#### åˆ é™¤ä¸æ›´æ–°

##### delete DMLå¯¹è¡¨æ•°æ®çš„ä¿®æ”¹

```sql
delete from TableName
 where // 	å¯ä»¥æœ‰æ¡ä»¶æ€§çš„è¿›è¡Œåˆ é™¤ï¼Œwhereä¸ºç©ºæ—¶ï¼Œæ¸…é™¤æ‰€æœ‰æ•°æ®ä½†ä¼šä¿ç•™å…³ç³»ç»“æ„
 where name in(
 				select name
     			from TableName
     			whereï¼Œï¼Œï¼Œ
 				)
 				//å¯ä»¥åœ¨è¿™é‡Œé€šè¿‡å¯¹åº”å±æ€§åç§°çš„æ–¹å¼æ¡ä»¶æ€§åˆ é™¤


DELETE FROM TableName
WHERE AttributeName=*some_value*;

// WHERE å­å¥è§„å®šå“ªæ¡è®°å½•æˆ–è€…å“ªäº›è®°å½•éœ€è¦åˆ é™¤ã€‚å¦‚æœæ‚¨çœç•¥äº† WHERE å­å¥ï¼Œæ‰€æœ‰çš„è®°å½•éƒ½å°†è¢«åˆ é™¤!

 

DELETE FROM TableName;
DELETE * FROM TableName;

// å¯ä»¥åœ¨ä¸åˆ é™¤è¡¨çš„æƒ…å†µä¸‹ï¼Œåˆ é™¤è¡¨ä¸­æ‰€æœ‰çš„è¡Œã€‚è¿™æ„å‘³ç€è¡¨ç»“æ„ã€å±æ€§ã€ç´¢å¼•å°†ä¿æŒä¸å˜(ä¿ç•™è¡¨å¤´çš„æƒ…å†µä¸‹ï¼Œæ¸…ç©ºæ‰€æœ‰çš„æ•°æ®å…ƒç»„ï¼‰
```

##### 	drop  DDLå¯¹è¡¨ç»“æ„çš„ä¿®æ”¹

è¡¨å’Œæ•°æ®éƒ½ä¼šè¢«åˆ é™¤

```sql
drop tablename
```

##### alter table é™å®šä½œç”¨è¡¨çš„å…·ä½“åç§°

```sql
alter table TableName add ArributeName Datatype
alter table TableName drop ArributeName
```

>å…³äºupdateå’Œalterï¼š
>
>ç™¾åº¦çŸ¥é“ä¸Šå…³äºupdateå’Œalteræœ‰ä¸€ä¸ªå¾ˆå½¢è±¡çš„æ€»ç»“ï¼š
>
>ä¸€ä¸ªè¡¨æœ‰å¾ˆå¤šå­—æ®µï¼Œä¸€ä¸ªå­—æ®µé‡Œæœ‰å¾ˆå¤šæ•°æ®ã€‚
>
>ä¸€ä¸ªå®¶æœ‰å¾ˆå¤šæˆ¿é—´ï¼Œä¸€ä¸ªæˆ¿é—´é‡Œæœ‰å¾ˆå¤šå®¶å…·ã€‚
>
>updateæ˜¯ç”¨æ¥å°†è¡£æŸœæ”¹æˆä¹¦æ¶çš„ã€‚ï¼ˆæ•°æ®å†…å®¹ï¼‰
>
>alteræ˜¯ç”¨æ¥å°†å¨æˆ¿æ”¹æˆå•æ‰€çš„ã€‚ï¼ˆå­—æ®µå±æ€§ï¼‰
>
>
>
>
>
>æŠŠå§å®¤æ”¹æˆå•æ‰€ï¼šï¼ˆå­—æ®µå±æ€§ï¼‰
>
>alter table ä½ å®¶ change å¨æˆ¿ å•æ‰€ varchar(8);
>
>åœ¨ä½ çš„å®¶é‡Œé¢åŠ ä¸€ä¸ªå•æ‰€ï¼š
>
>alter table ä½ å®¶ add å•æ‰€ varchar(8);ï¼ˆ8è¡¨ç¤ºå•æ‰€8å¹³ç±³ï¼‰
>
>ä¿®æ”¹å•æ‰€å¤§å°ï¼š
>
>alter table ä½ å®¶ modify(å•æ‰€ varchar(100))ï¼›
>
>æŠŠå•æ‰€æ›´åä¸ºæ´—æ‰‹é—´ï¼š
>
>alter table ä½ å®¶ rename column å•æ‰€ to æ´—æ‰‹é—´;
>
>æ‘§æ¯å•æ‰€ï¼š
>
>alter table ä½ å®¶ drop column å•æ‰€; è¿™é‡Œé¢æ˜¯å¯¹äºè¡¨ç»“æ„çš„ä¿®æ”¹ï¼Œè¦ç”¨drop
>
>
>
>
>
>è€ŒæŠŠè¡£æŸœæ”¹æˆä¹¦æ¶ï¼šï¼ˆæ•°æ®å†…å®¹ï¼‰
>
>update ä½ å®¶ set è¡£æŸœ=ä¹¦æ¶ where â€¦â€¦;ï¼ˆæ²¡æœ‰whereçš„è¯ï¼Œæ‰€æœ‰çš„æˆ¿é—´é‡Œé¢çš„è¡£æŸœå…¨éƒ¨å˜æˆäº†ä¹¦æ¶ï¼‰ã€‚
>
>update ä½ å®¶ set è¡£æŸœ=null where â€¦â€¦;åˆ é™¤è¡£æŸœã€‚
>
>
>
>deleteå’Œdropï¼š
>
>deleteæ˜¯åˆ é™¤è¡£æŸœæˆ–è€…åˆ é™¤ä¹¦æ¶çš„ï¼›
>
>dropæ˜¯åˆ é™¤æˆ¿é—´çš„ï¼›
>
>åˆ é™¤ä¸€ä¸ªè¡£æŸœï¼š
>
>delete from ä½ å®¶ where ID=è¡£æŸœ; å³ä½¿åˆ é™¤å®Œäº†æ•°æ®ï¼Œè¡¨ç»“æ„è¿˜æ˜¯æœ‰ã€‚
>
>åˆ é™¤ä¸€ä¸ªå«ç”Ÿé—´ï¼š
>
>alter table ä½ å®¶ drop column å•æ‰€;
>
>åˆ é™¤ä¸€ä¸ªæ•°æ®åº“ï¼š
>
>drop database ä½ å®¶;



å…³äºåˆ é™¤çš„ä¸‰ä¸ªè¯­å¥ï¼š**DROP**ã€**TRUNCATE**ã€ **DELETE** 

| DROP test;         | åˆ é™¤è¡¨testï¼Œå¹¶é‡Šæ”¾ç©ºé—´ï¼Œå°†teståˆ é™¤çš„ä¸€å¹²äºŒå‡€                 |
| ------------------ | ------------------------------------------------------------ |
| **TRUNCATE** test; | åˆ é™¤è¡¨testé‡Œçš„å†…å®¹ï¼Œå¹¶é‡Šæ”¾ç©ºé—´ï¼Œä½†ä¸åˆ é™¤è¡¨çš„å®šä¹‰ï¼Œè¡¨çš„ç»“æ„è¿˜åœ¨ã€‚ |
| **DELETE**         | 1ã€åˆ é™¤æŒ‡å®šæ•°æ® DELETE FROM test WHERE  age=30 AND country='US';  2ã€åˆ é™¤æ•´ä¸ªè¡¨   DELETE FROM test æˆ–è€… DELETE FROM test; |

**ç›¸åŒç‚¹ï¼š**dropã€deleteã€truncate éƒ½æ˜¯åˆ é™¤è¡¨çš„å†…å®¹ã€‚

**ä¸åŒç‚¹ï¼š**

+  **delete**ï¼šåˆ é™¤è¡¨çš„å†…å®¹ï¼Œè¡¨çš„ç»“æ„è¿˜å­˜åœ¨ï¼Œä¸é‡Šæ”¾ç©ºé—´ï¼Œå¯ä»¥å›æ»šæ¢å¤ï¼›
+  **drop**ï¼šåˆ é™¤è¡¨å†…å®¹å’Œç»“æ„ï¼Œé‡Šæ”¾ç©ºé—´ï¼Œæ²¡æœ‰å¤‡ä»½è¡¨ä¹‹å‰è¦æ…ç”¨ï¼›
+  **truncate**ï¼šåˆ é™¤è¡¨çš„å†…å®¹ï¼Œè¡¨çš„ç»“æ„å­˜åœ¨ï¼Œå¯ä»¥é‡Šæ”¾ç©ºé—´,æ²¡æœ‰å¤‡ä»½è¡¨ä¹‹å‰è¦æ…ç”¨ï¼›

**æ‰§è¡Œé€Ÿåº¦**ï¼š drop > truncate > delete



#### **æ›´æ–°**

```sql
UPDATE TableName
SET *column1*=*value1*,*column2*=*value2*,...
WHERE AttributeName=*some_value*; 

// WHERE å­å¥è§„å®šå“ªæ¡è®°å½•æˆ–è€…å“ªäº›è®°å½•éœ€è¦æ›´æ–°ã€‚å¦‚æœçœç•¥äº† WHERE å­å¥ï¼Œæ‰€æœ‰çš„è®°å½•éƒ½å°†è¢«æ›´æ–°ï¼
// SET ä¼šå¯¹é‡Œé¢çš„æ•°æ®è¿›è¡Œæ›´æ–°
// æ‰§è¡Œæ²¡æœ‰ WHERE å­å¥çš„ UPDATE è¦æ…é‡ï¼Œå†æ…é‡
```

$\color{red}{æ›´æ–°çš„é¡ºåºå¾ˆé‡è¦ï¼Œè¢«æ›´æ–°çš„æ•°æ®å¦‚æœç¬¦åˆä¸‹ä¸€æ¡è¯­å¥è¿˜ä¼šè¢«ç¬¬äºŒæ¬¡æ›´æ”¹ï¼}$

```sql
update instructor
set salary = salary * 1.05
where salary <= 100000;
update instructor
set salary = salary * 1.03
where salary > 100000;

ä¸¤ä¸ªç»“æœæ˜¯ä¸ä¸€æ ·çš„ï¼ï¼ï¼

update instructor
set salary = salary * 1.03
where salary > 100000;
update instructor
set salary = salary * 1.05
where salary <= 100000;
```

+ æ›´æ–°è¯­å¥ä¸­å¯ä»¥é€‚ç”¨ `case`è¯­å¥ã€‚

```sql
â€œall instructors with salary over $100,000 receive a 3 percent raise, whereas all others receive a 5 percent raise.â€

update instructor
set salary = case when salary <= 100000
					then salary * 1.05
				else salary * 1.03
				end
```

![image-20210202215506734](%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%AC%E4%B8%80%E6%AC%A1%E6%80%BB%E6%A6%82%E6%8B%AC%E6%91%98%E8%AE%B0%E7%82%B9.assets/image-20210202215506734.png)

```sql
Recompute and update tot_creds value for all students

update student S
set tot_cred = ( select sum credits
				from takes natural join course
				where S ID = takes ID and 
                	takes grade <> â€™Fâ€™ and  // <>ä¸ç­‰äº
                	takes grade is not null
                )



Sets tot_creds to null for students who have not taken any course. Instead of sum credits 

case
	when sum (credits) is not null
		then sum(credits}
	else 0
end
```



#### æŸ¥è¯¢**SELECT**

```sql
SELECT AttributeName,AttributeName
FROM TableName;

//SELECT è¯­å¥ç”¨äºä»æ•°æ®åº“ä¸­é€‰å–æ•°æ®ã€‚ç»“æœè¢«å­˜å‚¨åœ¨ä¸€ä¸ªç»“æœè¡¨ä¸­ï¼Œç§°ä¸ºç»“æœé›†ã€‚

 

SELECT DISTINCT AttributeName,AttributeName
FROM TableName; 

//DISTINCT å…³é”®è¯ç”¨äºè¿”å›å”¯ä¸€ä¸åŒçš„å€¼ã€‚

 
SELECT AttributeName,AttributeName
FROM TableName
WHERE *column_name operator value*;


//WHERE å­å¥ç”¨äºæå–é‚£äº›æ»¡è¶³æŒ‡å®šæ¡ä»¶çš„è®°å½•ã€‚é‡Œé¢å¯ä»¥ä½¿ç”¨æ•°å­¦è¡¨è¾¾å¼ï¼
//selectå­å¥ä¸­çš„æ˜Ÿå·æ˜Ÿå·è¡¨ç¤º â€œall selectâ€
//SQL ä½¿ç”¨å•å¼•å·æ¥ç¯ç»•æ–‡æœ¬å€¼ï¼ˆå¤§éƒ¨åˆ†æ•°æ®åº“ç³»ç»Ÿä¹Ÿæ¥å—åŒå¼•å·ï¼‰ã€‚
```

##### å†…éƒ¨å¯ä»¥æ»¡è¶³æ•°å­¦è¡¨è¾¾å¼

+ æ•°å­¦è¡¨è¾¾å¼å¯ä»¥å‡ºç°

+ + åœ¨ select ä¸­ä»£è¡¨ä¸´è¾“å‡ºå‰è¿›è¡Œçš„ç­›é€‰
    + åœ¨  from  ä¸­ä»£è¡¨å¯¹äºç­›é€‰æ¡ä»¶çš„æ•°å­¦è¿ç®—

+ **å†…éƒ¨é€šè¿‡ç¬›å¡å°”ç§¯æ¥å¿«é€Ÿæ»¡è¶³whereçš„é™å®šéœ€æ±‚**

+ ```sql
    select *
    from instructor, teaches
    â€“generates every possible instructor teaches,pair, with all attributes from both relations.
    ```

+ ![image-20210202185621979](%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%AC%E4%B8%80%E6%AC%A1%E6%80%BB%E6%A6%82%E6%8B%AC%E6%91%98%E8%AE%B0%E7%82%B9.assets/image-20210202185621979.png)

##### **å†…éƒ¨ä¿®é¥°çš„é€»è¾‘è¿æ¥è¯**

+ 

| And  | ä¸  åŒæ—¶æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶çš„å€¼ã€‚ | Select * from emp   where  sal > 2000 and sal < 3000; | æŸ¥è¯¢ EMP è¡¨ä¸­ SAL åˆ—ä¸­å¤§äº 2000 å°äº 3000 çš„å€¼ã€‚  |
| ---- | -------------------------- | ----------------------------------------------------- | ------------------------------------------------- |
| Or   | æˆ–  æ»¡è¶³å…¶ä¸­ä¸€ä¸ªæ¡ä»¶çš„å€¼   | Select * from emp   where  sal > 2000 or comm > 500;  | æŸ¥è¯¢ emp è¡¨ä¸­ SAL å¤§äº 2000 æˆ– COMM å¤§äº500çš„å€¼ã€‚ |
| Not  | é  æ»¡è¶³ä¸åŒ…å«è¯¥æ¡ä»¶çš„å€¼   | select * from emp   where  not sal > 1500;            | EMPè¡¨ä¸­  sal å°äºç­‰äº 1500 çš„å€¼ã€‚                 |

##### **å†…éƒ¨çš„æŸ¥è¯¢èŒƒå›´æ§åˆ¶è¯**

 

| is null     | ç©ºå€¼åˆ¤æ–­    | Select * from emp   where  comm is null;              | æŸ¥è¯¢ emp è¡¨ä¸­ comm åˆ—ä¸­çš„ç©ºå€¼                                |
| ----------- | ----------- | ----------------------------------------------------- | ------------------------------------------------------------ |
| between and | åœ¨ ä¹‹é—´çš„å€¼ | Select * from emp   where  sal between 1500 and 3000; | æŸ¥è¯¢ emp è¡¨ä¸­ SAL åˆ—ä¸­å¤§äº 1500 çš„å°äº 3000 çš„å€¼ã€‚              å¤§äºç­‰äº 1500 ä¸”å°äºç­‰äº 3000ï¼Œ 1500 ä¸ºä¸‹é™ï¼Œ3000 ä¸ºä¸Šé™ï¼Œä¸‹é™åœ¨å‰ï¼Œä¸Šé™åœ¨åï¼ŒæŸ¥è¯¢çš„èŒƒå›´åŒ…æ¶µæœ‰ä¸Šä¸‹é™çš„å€¼ã€‚ |
| In          | å€¼åœ¨Â·Â·Â·ä¸­   | Select * from emp   where  sal in (5000,3000,1500);   | æŸ¥è¯¢ EMP è¡¨ SAL åˆ—ä¸­ç­‰äº 5000ï¼Œ3000ï¼Œ1500 çš„å€¼ã€‚             |
| like        | æ¨¡ç³ŠæŸ¥è¯¢    | Select *  from emp   where ename like 'M%';           | æŸ¥è¯¢ EMP è¡¨ä¸­ Ename åˆ—ä¸­æœ‰ M çš„å€¼ï¼ŒM ä¸ºè¦æŸ¥è¯¢å†…å®¹ä¸­çš„æ¨¡ç³Šä¿¡æ¯ã€‚**%** è¡¨ç¤ºå¤šä¸ªå­—å€¼ï¼Œ**_** ä¸‹åˆ’çº¿è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼›      **M%** : ä¸ºèƒ½é…ç¬¦ï¼Œæ­£åˆ™è¡¨è¾¾å¼ï¼Œè¡¨ç¤ºçš„æ„æ€ä¸ºæ¨¡ç³ŠæŸ¥è¯¢ä¿¡æ¯ä¸º M å¼€å¤´çš„ã€‚      **%M%** : è¡¨ç¤ºæŸ¥è¯¢åŒ…å«Mçš„æ‰€æœ‰å†…å®¹ã€‚      **%M_** :         è¡¨ç¤ºæŸ¥è¯¢ä»¥Måœ¨å€’æ•°ç¬¬äºŒä½çš„æ‰€æœ‰å†…å®¹ã€‚ |

##### **å†…éƒ¨å¯¹ç»“æœé›†è¿›è¡Œæ’åº**

```sql
SELECT AttributeName,AttributeName
FROM TableName
ORDER BY AttributeName,AttributeName  ASC | DESC;

// ORDER BY å…³é”®å­—ç”¨äºå¯¹ç»“æœé›†æŒ‰ç…§ä¸€ä¸ªåˆ—æˆ–è€…å¤šä¸ªåˆ—è¿›è¡Œæ’åºã€‚

// ORDER BY å…³é”®å­—é»˜è®¤æŒ‰ç…§å‡åº ASC å¯¹è®°å½•è¿›è¡Œæ’åºã€‚å¦‚æœéœ€è¦æŒ‰ç…§é™åºå¯¹è®°å½•è¿›è¡Œæ’åºï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ DESC å…³é”®å­—ã€‚

// ORDER BY å¤šåˆ—çš„æ—¶å€™ï¼Œå…ˆæŒ‰ç…§ç¬¬ä¸€ä¸ªcolumn nameæ’åºï¼Œå†æŒ‰ç…§ç¬¬äºŒä¸ªcolumn nameæ’åº
```

#####  **å†…éƒ¨æŸ¥è¯¢æ•°æ®ç»“æœæ•°ç›®é™å®š**

```sql
SELECT TOP *number* | *percent* AttributeNames
FROM TableName
```



1. SELECT TOP å­å¥ç”¨äºè§„å®šè¦è¿”å›çš„è®°å½•çš„æ•°ç›®ã€‚
2. SELECT TOP     å­å¥å¯¹äºæ‹¥æœ‰æ•°åƒæ¡è®°å½•çš„å¤§å‹è¡¨æ¥è¯´ï¼Œæ˜¯éå¸¸æœ‰ç”¨çš„ã€‚
3. ä½¿ç”¨ç™¾åˆ†æ¯”ä½œä¸ºå‚æ•°ï¼Œä»£è¡¨æ‰§è¡Œå‰ 50% çš„æ•°æ®

 

##### **å†…éƒ¨ç›¸ä¼¼æ€§æŸ¥è¯¢é™å®š**

```sql
SELECT AttributeNames
FROM TableName
WHERE AttributeName LIKE *pattern*;
```

â€‹														é€šé…ç¬¦*pattern (**æ­£åˆ™è¡¨è¾¾å¼é‡Œçš„å†…å®¹ï¼‰*

| %                              | æ›¿ä»£ 0 ä¸ªæˆ–å¤šä¸ªå­—ç¬¦        | SELECT * FROM  Websites  WHERE  url LIKE '%oo%';    | é€‰å– url åŒ…å«æ¨¡å¼ "oo" çš„æ‰€æœ‰ç½‘ç«™ï¼š                     |
| ------------------------------ | -------------------------- | --------------------------------------------------- | ------------------------------------------------------- |
|                                |                            | SELECT * FROM  Websites  WHERE  url LIKE 'https%';  | é€‰å– url  ä»¥å­—æ¯ "https" å¼€å§‹çš„æ‰€æœ‰ç½‘ç«™ï¼š               |
| _                              | æ›¿ä»£ä¸€ä¸ªå­—ç¬¦               | SELECT * FROM  Websites  WHERE  name LIKE '_oogle'; | é€‰å– name ä»¥ä¸€ä¸ªä»»æ„å­—ç¬¦å¼€å§‹ï¼Œç„¶åæ˜¯ "oogle" çš„æ‰€æœ‰å®¢æˆ· |
| [*charlist*]                   | å­—ç¬¦åˆ—ä¸­çš„ä»»ä½•å•ä¸€å­—ç¬¦     |                                                     |                                                         |
| [^*charlist*] æˆ– [!*charlist*] | ä¸åœ¨å­—ç¬¦åˆ—ä¸­çš„ä»»ä½•å•ä¸€å­—ç¬¦ |                                                     |                                                         |

#####  **å†…éƒ¨æŸ¥è¯¢è¿‡ç¨‹æ•°æ®é‡å‘½å**

åˆ«å  å¯ä»¥ä¸ºè¡¨åç§°æˆ–åˆ—åç§°æŒ‡å®šåˆ«åï¼Œåˆ›å»ºåˆ«åæ˜¯ä¸ºäº†è®©åˆ—åç§°çš„å¯è¯»æ€§æ›´å¼ºã€‚

```sql
SELECT AttributeName 
AS alias_name
FROM tablename;
```

â€‹	==åœ¨ä¸‹é¢çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨åˆ«åå¾ˆæœ‰ç”¨ï¼š==

1. ==åœ¨æŸ¥è¯¢ä¸­æ¶‰åŠè¶…è¿‡ä¸€ä¸ªè¡¨==
2. ==åœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨äº†å‡½æ•°==
3. ==åˆ—åç§°å¾ˆé•¿æˆ–è€…å¯è¯»æ€§å·®==
4. ==éœ€è¦æŠŠä¸¤ä¸ªåˆ—æˆ–è€…å¤šä¸ªåˆ—ç»“åˆåœ¨ä¸€èµ·==

#####  **æ›´å**

```sql
select ID, name, salary/12 as monthly_salary
from instructor           //å°†å¹´è–ªé™¤ä»¥åäºŒé‡å‘½åä¸ºæœˆè–ª
```

â€‹	åˆ©ç”¨æ›´åå¯ä»¥å®ç°**è‡ªè¿æ¥**  ï¼Œè‡ªè¿æ¥å¯ä»¥å®ç°å†…éƒ¨çš„ä¾ç…§äºè‡ªå·±çš„æ•°æ®ç­›é€‰ã€‚==æ›´åè¿ç®—æ˜¯è‡ªè”ç»“çš„å…³é”®ï¼==



æ‰¾æœ€å¤§å·¥èµ„ï¼š

```sql
select distinct T. name
from instructor as T, instructor as S
where T.salary > S.salary and S.dept_name =â€˜Comp.SCI'
 //as åœ¨Oracleé‡Œé¢æ˜¯ omitted
```

##### **å­—ç¬¦ä¸²è¿ç®—**

+ å­—ç¬¦ä¸²åŸåˆ™ä¸Šä½¿ç”¨å•å¼•å·ï¼Œå½“å¥å­å†…éƒ¨æœ‰å¼•å·æ—¶ï¼Œå¯ä»¥ä½¿ç”¨åŒå¼•å·æ¥é˜²æ­¢åŒ¹é…é”™è¯¯ã€‚
+ æ”¯æŒå­—ç¬¦ä¸²çš„ä¸²è”  â€”â€”â€œ||â€
+ å¤§å°å†™è½¬æ¢ upper(s) & lower(s)
+ â€œ \ â€ åœ¨ä¸€äº›æƒ…å†µä¸‹ä¼šè¢«ç”¨ä½œè½¬ä¹‰å­—ç¬¦ï¼

##### **é›†åˆè¿ç®—**

+ Aå¹¶B(Aæˆ–B)

    ```sql
    Find courses that ran in Fall 2009 or in Spring 2010
    
    (select course_id from section where sem = â€˜Fallâ€™ and year = 2009)
    union
    select course_id from section where sem = â€˜Springâ€™ and year = 2010)
    ```

+ Aäº¤B(Aä¸”B)

    ```sql
    Find courses that ran in Fall 2009 and in Spring 2010
    
    (select course_id from section where sem = â€˜Fallâ€™ and year = 2009)
    intersect
    select course_id from section where sem = â€˜Springâ€™ and year = 2010)
    ```

+ Aå·®B(Aä¸­é™¤å»B)

    ```sql
    Find courses that ran in Fall 2009 but not in Spring 2010
    
    (select course_id from section where sem = â€˜Fallâ€™ and year = 2009)
    except
    select course_id from section where sem = â€˜Springâ€™ and year = 2010)
    ```

    ä¸Šè¿°çš„ä¸‰ä¸ªè¿ç®—éƒ½æ˜¯ ==å»é‡çš„== æƒ³è¦ä¸å»é‡ åœ¨åé¢åŠ ä¸Š all

##### **å…³äºç©ºå€¼ NULL**

+ ç©ºå€¼æ„å‘³ç€æœªçŸ¥å€¼ æˆ–è€…æ˜¯ ä¸å­˜åœ¨çš„å€¼

+ ç©º + ç®—æ•°å€¼ ç»“æœè¿˜æ˜¯ç©ºå€¼ï¼ `ä¸ç­‰äº 0 è¿™ä¸ªæ•°çš„è¿ç®— `

+ å¯ä»¥ç”¨ is null æ¥åˆ¤æ–­ç©ºå€¼

    ```sql
    select name
    from instructor
    where salary is null
    ```

+ ç©ºå€¼åœ¨æ‰€æœ‰çš„é€»è¾‘è¿ç®—ä¸­ éƒ½é»˜è®¤ä¸º ==ä¸ç¡®å®šï¼ˆä¸æ˜¯ä¸ºå¦ï¼‰è¿™ä¸ªæ˜¯ä¸¤ç§æ¦‚å¿µ==

    ä½†æ˜¯å½“ç©ºå€¼åœ¨==åˆ¤æ–­éç©ºçš„æ—¶å€™ æ˜¯çœŸçš„==

##### **èšé›†å‡½æ•°ï¼ˆç›¸å½“äºä½œç”¨äºæ•°æ®çš„è¿ç®—å‡½æ•°ï¼‰**

+ Average: avg

    ```sql
    select avg (salary)
    from instructor
    where dept_name= â€™Comp. Sci.â€™  //è¦æ˜¯æ··ä¹±äº†æ³¨æ„æ‰§è¡Œé¡ºåºå°±æ˜ç™½äº†
    ```

    åœ¨è¿™é‡Œå¯ä»¥ç”¨ as æ¥ä¿ç•™å…¶é‡è¦çš„ä¸­é—´æ­¥éª¤æ•°æ®

+ Minimum: min

+ Maximum: max

+ Total : sum

+ Count: count

    ```sql
    â€œFind the total number of instructors who teach a course in the Spring 2010 semester.â€ 
    
    
    select count ( distinct ID)
    from teaches
    where semester = â€™Springâ€™ and year = 2010;
    ```

    è¿™é‡Œé¢çš„ `distinct` æ˜¯å»é‡è®¡æ•°çš„æ„æ€ã€‚

    ==**é™¤äº† count(*) å¤–æ‰€æœ‰çš„èšé›†å‡½æ•°éƒ½å¿½ç•¥è¾“å…¥é›†åˆä¸­çš„ç©ºå€¼**==ï¼Œå¯¹äºå…¨ç©ºçš„æ•°æ®ï¼Œcount è¿”å› ä¸º 0ï¼Œå…¶ä½™çš„èšé›†å‡½æ•°è¿”å›ä¸º NULLã€‚

##### **åˆ†ç»„**

+ åˆ†ç»„ å¯ä»¥å®ç°ä¾ç…§æŸä¸€æ ‡å‡†è¿›è¡Œè¿ç®—ã€‚

    ```sql
    E.g. â€œFind the average salary in each department.â€
    
    
    select dept name , avg (salary) as avg_salary
    from instructor
    group by dept_name
    â€“
    
    ```

    $\color{red}{Note: departments \space with \space no instructor \space will \space not \space appear \space in \space result}$

    **==å‡ºç°åœ¨ select å­å¥ä¸­ä½†æ²¡æœ‰è¢«èšé›†çš„å±æ€§å¿…é¡»å‡ºç°åœ¨ group by å­å¥ä¸­==**ï¼Œä¸ç„¶ä¼šå¯¼è‡´é€»è¾‘æ··ä¹±äºè¿ç®—æ··ä¹±ã€‚

##### **åŒ…å«**

+ åŒ…å« `having`

    ```sql
    Try: Find the names and average salaries of all departments whose average salary is greater than 42000
    
    
    select dept_name , avg (salary)
    from instructor
    group by dept_name
    having avg (salary) > 42000
    
    						//æ³¨æ„è¿™é‡Œçš„æ‰§è¡Œé¡ºåº
    ```

    $\color{red}{ç”¨åœ¨ having ä¸­çš„è°“è¯åœ¨å½¢æˆåˆ†ç»„åæ‰èµ·ä½œç”¨ï¼Œè€Œ where å­å¥ä¸­çš„è°“è¯åœ¨åˆ†ç»„å‰èµ·ä½œç”¨ã€‚æ¯”å¦‚ï¼š}$

    ```sql
    Try: â€œFor each course section offered in 2009, find the average total credits (tot_cred) of all students enrolled in the section, if the section had at least 2
    students.â€
    ```

    ![image-20210202214620246](%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%AC%E4%B8%80%E6%AC%A1%E6%80%BB%E6%A6%82%E6%8B%AC%E6%91%98%E8%AE%B0%E7%82%B9.assets/image-20210202214620246.png)

#### **åµŒå¥—å­æŸ¥è¯¢(whereè¯­å¥ä¸­)**

+ å­æŸ¥è¯¢æ˜¯åµŒå¥—åœ¨å¦ä¸€ä¸ªæŸ¥è¯¢ä¸­çš„ select from where è¡¨è¾¾å¼

+ è¿æ¥è¯ in æµ‹è¯•å…ƒç»„æ˜¯å¦æ˜¯é›†åˆBä¸­çš„æˆå‘˜ï¼Œé›†åˆBæ˜¯ç”± select å­å¥äº§ç”Ÿçš„
    ä¸€ç»„å€¼æ„æˆçš„ã€‚

+ è¿æ¥è¯ not in åˆ™æµ‹è¯•å…ƒç»„æ˜¯å¦ä¸æ˜¯é›†åˆä¸­çš„æˆå‘˜.

+  `in` å’Œ `not in`æ“ä½œç¬¦ä¹Ÿèƒ½ç”¨äºæšä¸¾é›†åˆ.

    ```sql
    select distinct name
    from instructor
    where name not in (â€™Mozartâ€™, â€™Einstein') //ä¸åœ¨æ‰€åˆ—ä¸¾çš„å…ƒç´ ä¸­
    ```

##### **é›†åˆé—´çš„æ¯”è¾ƒ**

+ â€‹	ä½¿ç”¨`some`è¿™ä¸ªè¯æ¥ä¿®é¥°é™å®š.

    ```sql
    select distinct T.name
    from instructor as T, instructor as S
    where T.salary > S.salary and S.dept_name=â€™Biologyâ€™;
    
    select name
    from instructor
    where salary > some(select salary
    					from instructor
    					where dept_name=â€™Biologyâ€™
                       );
    ```

    ==åœ¨SQLé‡Œé¢ `any`å’Œ`some`æ˜¯ä¸€ä¸ªæ„æ€,éƒ½æ˜¯è¡¨ç¤ºåœ¨æŸä¸€èŒƒå›´ä¸­å­˜åœ¨ä¸€ä¸ª.==

+ (=some ) $\equiv$ in

    ($\neq$ some ) $$\neq$$ not in

+ `all`å¯ä»¥ç”¨æ¥ä¿®é¥°é™å®š`æ‰€æœ‰`,==è¡¨ç¤ºåœ¨æŸä¸€èŒƒå›´ä¸­å¯¹é›†åˆä»»æ„å…ƒç´ æ»¡è¶³==

    ```sql
    select name
    from instructor
    where salary > all (select salary
    					from instructor
    					where	dept_name = 'biology');
    ```

+ åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œä½¿ç”¨ `some`,`any` æˆ– `all` çš„å­æŸ¥è¯¢é€»è¾‘ ç­‰ ä»·äºå¯¹ä½¿ç”¨èšåˆ
    çš„å­æŸ¥è¯¢è¿›è¡Œç›¸ç­‰æ¯”è¾ƒ.

##### **ç›¸å…³å­æŸ¥è¯¢**

+ ç›¸å…³å­æŸ¥è¯¢ å°±æ˜¯ä½¿ç”¨ä¸€ä¸ªåˆ«åæ¥å¯¹å¤–å±‚æŸ¥è¯¢ä¸­çš„ä¸œè¥¿è¿›è¡Œå¼•ç”¨çš„æŸ¥è¯¢

+ ä½¿ç”¨`exist`æ¥ä¸‹è¿›è¡Œç›¸å…³å­æŸ¥è¯¢,å¯ç¿»è¯‘ä¸º `ä¸”å­˜åœ¨æœ‰ç¬¦åˆæ¡ä»¶`

    ```sql
    select ID,name
    from student
    where ( select COUNT(*)
    		from takes
    		where takes.ID=student.ID
    		group by takes.ID
          )>2;  //æŸ¥è¯¢å‡ºé€‰è¯¾æ•°å¤§äºäºŒçš„æ‰€æœ‰äºº
    ```

+ `not exist`æµ‹è¯•å­æŸ¥è¯¢ç»“æœé›†ä¸­æ˜¯å¦ä¸å­˜åœ¨å…ƒç»„. 

    ==å¯ä»¥å°†`å…³ç³»AåŒ…å«B`æ”¹å†™æˆ `not exist (B except A)`,==  æ„æ€å°±æ˜¯Bä¸­ä¸å­˜åœ¨é™¤äº†Aä»¥å¤–çš„å…ƒç´ .

    ```sql
    Find all students who have taken all courses offered in the Biology department.
    select distinct S ID , S name
    from student as S
    where not exists ( select course_id
    					from course
    					where dept_name = 'biology'
    				except
    				 ( select T course_id
    				   from takes as T
                       where S.ID = T.ID );
                      
    ```

#### **åµŒå¥—å­æŸ¥è¯¢(fromè¯­å¥ä¸­)**

+ æ­¤å¤„åº”ç”¨çš„å…³é”®æ¦‚å¿µæ˜¯ï¼Œä»»ä½•ä»è¡¨è¾¾å¼å­æŸ¥è¯¢è¿”å›ç»“æœ,å¯ä»¥å°†å…¶æ’å…¥å…¶ä½™å­æŸ¥è¯¢ä¸­ä½œä¸ºä¸€ä¸ªæ•´ä½“çš„å…³ç³»ä½¿ç”¨ã€‚

    ```sql\
    Find the average instructorsâ€™ salaries of those departments where the average salary is greater than $42,000.
    
    select dept_name,avg_salary
    from (
    	  select dept_name,avg(salary) as avg_salary
    	  from instructor
    	  group by dept_name
    	 )
    where avg_salary > 42000
    		//åœ¨fromå­å¥æ‰€é™å®šçš„èŒƒå›´ä¸­è¿›è¡Œæœç´¢
    		ä¹Ÿå¯ä»¥è¢«æ”¹å†™ä¸º:
    select dept_name,avg_salary
    from (select dept_name,avg (salary)
    	  from instructor
          group by dept_name)as dept_avg(dept_name,avg_salary)
    where avg_salary > 42000
    
    	//ä¸Šè¿°ç»“æœè¢«å‘½åä¸ºä¸€ä¸ªæ–°çš„å…³ç³»dept_avg,è¿™ä¸ªå…³ç³»ä¸­æœ‰ä¸¤ä¸ªå±æ€§,åªä¸è¿‡åœ¨æœ¬æŸ¥è¯¢ä¸­æ²¡æœ‰è¢«ä½¿ç”¨,ä½†å´å®å®åœ¨åœ¨ç”Ÿæˆäº†.
    ```

#### **with å­å¥ **

+ ä¸ä¸Šä¸€ä¸ª`as`,ç›¸æ¯”,è¿™ä¸ªå¯ä»¥æ›´åŠ æœ‰æ•ˆçš„**å®šä¹‰å±€éƒ¨çš„ä¸´æ—¶å…³ç³»**.

    ```sql
    Find all departments with the maximum budget
    
    with max_budget (value) as (select max(budget)
    							from department) //å…ˆå±€éƒ¨å®šä¹‰å‡ºä¸€ä¸ªæ–°çš„å…³ç³» æœ€å¤§é¢„ç®—, é‡Œé¢æœ‰ä¸€ä¸ªå±æ€§å°±æ˜¯å€¼(å‚æ•°),ç›¸å½“äºå±€éƒ¨å‡½æ•°çš„å°è£….
    select dept_name,budget
    from department,max_budget
    where department.budget = max_budget.value
    ```

+ å¯¹äºé€»è¾‘ç»“æ„è¾ƒä¸ºå¤æ‚çš„æŸ¥è¯¢ `with`å¯ä»¥ä½¿æ•´ä½“æŸ¥è¯¢å˜å¾—æ›´åŠ ç®€ä¾¿.

    ```sql
    Find all departments where the total salary is greater than the average of the total salary at all departments 
    
    
    with dept_total(dept_name ,value) as(
    								select dept_name , sum salary
    								from instructor
        							group by dept_name)//è¿™é‡Œselectçš„è¯­å¥åœ¨å‘å¤–ä¼ é€’å‚¨å­˜çš„æ—¶å€™,ç›´æ¥æ¢äº†å,ä½¿ç”¨æ›´æ–¹ä¾¿äº†.
    dept_total_avg(value) as(select avg(value)
    						 from dept_total)//åœ¨è¿™é‡Œåˆå¯¹ä¸Šä¸€ä¸ªå°è£…å¥½çš„å…³ç³»ä¸­çš„æŸä¸€æ•°æ®è¿›è¡Œäº†è¿›ä¸€æ­¥çš„å¤„ç†
    select dept_name
    from dept_total, dept_total_avg
    where dept_total.value >= dept_total_avg.value
    ```

#### æ ‡é‡å­æŸ¥è¯¢

+ å­æŸ¥è¯¢çš„è¾“å‡ºç»“æœä»…ä¸ºä¸€ä¸ªå±æ€§çš„ä¸€ä¸ªå…ƒç»„,ç›¸å½“äº==æŸ¥è¯¢ç»“æœå¯¹å¤–è¾“å‡ºä¸ºä¸€ä¸ªç‹¬ç«‹å˜é‡.==

+ æ ‡é‡å­æŸ¥è¯¢çš„ç»“æœä»ç„¶æ˜¯å…³ç³»,å°½ç®¡åªæœ‰å•ä¸ªå…ƒç»„.å¦‚æœæœ‰ä¸æ­¢ä¸€ä¸ªå…ƒç»„,åˆ™ä¼šè¿”å›é”™è¯¯.

+ æ ‡é‡å­æŸ¥è¯¢å¯ä»¥å‡ºç°åœ¨`select` ,`where`,`having`ä¸­.

    ```sql
    E.g. select dept_name ,(select count (*)
    	from instructor
    	where department dept_name = instructor dept_name) as num_instructors
    from department
    
    
    
    E.g. select name
    	from instructor
    	where salary * 10 >
    	(select budget from department
    	 where department dept_name = instructor dept_name)
    
    ```

### æ›´ğŸ‚:cow2::ox:çš„SQL

#### **å¤šè¡¨è¿æ¥æ€§æŸ¥è¯¢æ–¹å¼**

##### Natural Join è‡ªç„¶è¿æ¥

â€‹	è‡ªç„¶è¿æ¥ä»…è€ƒè™‘é‚£äº›åœ¨ä¸¤ä¸ªå…³ç³»æ¨¡å¼ä¸­éƒ½å‡ºç°çš„å±æ€§ä¸Šå–å€¼ç›¸åŒçš„å…ƒç´ å¯¹ï¼Œæ¯ä¸€ä¸ªç›¸åŒå±æ€§åˆ—ä»…ç•™ä¸€ä¸ªæ‹·è´ã€‚

```sql
select *
from instructor natural join teaches
```

åŒä¸€ç§æ„æ€çš„ä¸¤ç§ä¹¦å†™æ–¹å¼

```sql
â€“
select name, course_id
from instructor, teaches
where instructor.ID = teaches.ID;
â€“
select name, course_id
from instructor natural join teaches;
```

+ å¯¹äºè¿™æ ·çš„è‡ªç„¶è¿æ¥ å¯èƒ½æœ‰ä¸ç›¸å¹²å±æ€§å´ç›¸åŒé”®å€¼è¢«å¼•å…¥ã€‚
+ Mysqlæ²¡æœ‰è‡ªç„¶è¿æ¥
+ ç†è§£å’Œæ‰§è¡Œé¡ºåºæ˜¯ å…ˆ from å†where æœ€åselect

##### é«˜çº§ç‰ˆçš„å¤–è¿æ¥

+ ä¸ºä»€ä¹ˆè¦ç”¨å¤–è¿æ¥?

    å› ä¸ºåœ¨æŸ¥è¯¢çš„æ—¶å€™ä¼šå‡ºç°ä¸€ä¸ªè¡¨æœ‰æ•°æ®,ä¸€ä¸ªè¡¨æ²¡æœ‰å¯¹åº”æ•°æ®çš„æƒ…å†µ,æ‰€ä»¥ä¸€å®šè¦åˆå¹¶æŸ¥æ‰¾.å¯ä»¥==é¿å…ä¿¡æ¯ä¸¢å¤±==

+ + ![image-20210202181616318](%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AC%AC%E4%B8%80%E6%AC%A1%E6%80%BB%E6%A6%82%E6%8B%AC%E6%91%98%E8%AE%B0%E7%82%B9.assets/image-20210202181616318.png)

+ + SQL   JOIN å­å¥ç”¨äºæŠŠæ¥è‡ªä¸¤ä¸ªæˆ–å¤šä¸ªè¡¨çš„è¡Œç»“åˆèµ·æ¥ï¼ŒåŸºäºè¿™äº›è¡¨ä¹‹é—´çš„å…±åŒå­—æ®µã€‚

+ + + **LEFT JOIN**ï¼šå³ä½¿å³è¡¨ä¸­æ²¡æœ‰åŒ¹é…ï¼Œä¹Ÿä»å·¦è¡¨è¿”å›æ‰€æœ‰çš„è¡Œ
        + **RIGHT JOIN**ï¼šå³ä½¿å·¦è¡¨ä¸­æ²¡æœ‰åŒ¹é…ï¼Œä¹Ÿä»å³è¡¨è¿”å›æ‰€æœ‰çš„è¡Œ
        + **INNER JOIN**ï¼šå¦‚æœè¡¨ä¸­æœ‰è‡³å°‘ä¸€ä¸ªåŒ¹é…ï¼Œåˆ™è¿”å›è¡Œ
        + **FULL JOIN**ï¼šåªè¦å…¶ä¸­ä¸€ä¸ªè¡¨ä¸­å­˜åœ¨åŒ¹é…ï¼Œåˆ™è¿”å›è¡Œ

```sql
Find all students who have not taken a
course

select * 
from student natural left outer join takes;
select *
from student left outer join takes 
on student.ID=takes.ID

ç­‰ä»·äº

select *
from student left outer join takes on student.ID=takes.ID

select *
from student left outer join takes on true
where student.ID= takes.ID

SELECT AttributeNames
FROM Table1 INNER JOIN Table2
ON *table1.column_name*=*table2.column_name*;
```

ä½¿ç”¨ **join** æ—¶ï¼Œ**on** å’Œ **where** æ¡ä»¶çš„åŒºåˆ«å¦‚ä¸‹ï¼š

+  **on** æ¡ä»¶æ˜¯åœ¨ç”Ÿæˆä¸´æ—¶è¡¨æ—¶ä½¿ç”¨çš„æ¡ä»¶ï¼Œå®ƒä¸ç®¡ **on** ä¸­çš„æ¡ä»¶æ˜¯å¦ä¸ºçœŸï¼Œéƒ½ä¼šè¿”å›å·¦è¾¹è¡¨ä¸­çš„è®°å½•ï¼ˆ*table1.column_name**ï¼‰*ã€‚
+  **where** æ¡ä»¶æ˜¯åœ¨ä¸´æ—¶è¡¨ç”Ÿæˆå¥½åï¼Œå†å¯¹ä¸´æ—¶è¡¨è¿›è¡Œè¿‡æ»¤çš„æ¡ä»¶ã€‚è¿™æ—¶å·²ç»æ²¡æœ‰ **left join** çš„å«ä¹‰ï¼ˆå¿…é¡»è¿”å›å·¦è¾¹è¡¨çš„è®°å½•ï¼‰äº†ï¼Œæ¡ä»¶ä¸ä¸ºçœŸçš„å°±å…¨éƒ¨è¿‡æ»¤æ‰ã€‚==$\color{red}{æ‰€ä»¥åœ¨è¿™é‡Œå»ºè®®ä½¿ç”¨ ON ï¼ï¼}$==

ä¾‹ï¼›

```sql
SELECT Websites.id, Websites.name, access_log.count,access_log.date
FROM Websites INNER JOIN access_log //å…±æœ‰çº¢è‰²éƒ¨åˆ†
ON Websites.id=access_log.site_id; // åŸºäºæ€æ ·çš„æ ‡å‡†æ¥è¿›è¡Œ JOIN
```

#### è§†å›¾

##### è§†å›¾å®šä¹‰

+ è®¾è®¡å‡ºçš„ç»™ä¸åŒç”¨æˆ·çš„æä¾›æ•°æ®çš„é»˜è®¤æ£€ç´¢è™šå‡½æ•°.
+ ç”¨ä¸€ç§å›ºå®šçš„æ¨¡å¼æ¥ç»„åˆæ‹¼æ¥åŸå­æ€§çš„æ•°æ®,æ¥å®ç°ä¸åŒçš„æŸ¥è¯¢éœ€è¦.

```sql\
create view Name as DataSource
where


//where <query expression> æ˜¯ä¸€ç§åˆæ³•çš„è°“è¯
//Væ˜¯è§†çª—çš„åå­—
```

```sql
A view of instructors without their salary

create view faculty as
	select ID, name, dept_name
	from instructor
	
```

```sql
Create a view of department salary totals

create view departments_total_salary(dept_name, total_salary)
as
select dept_name, sum (alary)
from instructor
group by dept_name;
```

##### ç‰©åŒ–è§†å›¾

é€šè¿‡è§†å›¾å‘ˆç°å‡ºä¸€ä¸ªå®å®åœ¨åœ¨çš„ç‰©ç†ä¸Šçš„å›¾.

å¯¹äºæ›´æ–°å·²ç»ç‰©åŒ–çš„è§†å›¾,åˆ™è¢«ç§°ä¸º==ç‰©åŒ–è§†å›¾ç»´æŠ¤==.

##### ä¸¢å¼ƒè§†å›¾

```sql
drop view ViewName
```

<u>å…³äºå·²ç»è¢«ä¸¢å¼ƒçš„è§†å›¾çš„æ‰€æœ‰è§†å›¾éƒ½è¦è¢«ä¸¢å¼ƒæ‰!</u>

##### æ›´æ–°è§†å›¾

å‘è§†å›¾å†…æ’å…¥ä¸€ä¸ªç°æˆçš„å…ƒç»„

```sql
insert into faculty 
values (â€™30765â€™, â€™Greenâ€™)
```

> æ»¡è¶³å¦‚ä¸‹æŸ¥è¯¢æ¡ä»¶çš„è§†å›¾,å°±æ˜¯å¯æ›´æ–°çš„
>
> + fromä¸­åªæœ‰ä¸€ä¸ªæ•°æ®åº“å…³ç³».(ä¸ç„¶å°±ä¸åˆ«çš„è¡¨æœ‰ç‰µè¿)
> + selectä¸­åªåŒ…å«å…³ç³»çš„å±æ€§å,ä¸åŒ…å«ä»»ä½•çš„è¡¨è¾¾å¼,èšé›†æˆ–è€…æ˜¯ distinct å£°æ˜.(ä¸ç„¶æ›´æ–°çš„æ—¶å€™,å°±ä¼šå¯¼è‡´ä¸€ä¸ªæ•°æ®çš„å˜åŒ–å½±å“ä¸€ç¾¤)
> + ä»»ä½•æ²¡æœ‰å‡ºç°åœ¨selectè¯­å¥ä¸­çš„å±æ€§å¯ä»¥ä¸ºç©º(æ—¢æ²¡æœ‰notnullçº¦æŸ,ä¹Ÿä¸ä½œä¸ºä¸»ç )
> + æŸ¥è¯¢é‡Œé¢æ²¡æœ‰ group by æˆ–è€…æ˜¯ having(å±æ€§ä¸åœ¨having,å°±ä¸€å®šè¦åœ¨group by æ”¹èµ·æ¥ä¼šæœ‰æ­§ä¹‰)

`with check option `å¯ä»¥åœ¨è§†å›¾çš„å®šä¹‰æœ«å°¾è¡¨æ˜,è¿™æ ·ä»¥åå†æœ‰ä¸ç¬¦åˆæ¡ä»¶çš„whereè¯­å¥è¢«æ·»åŠ æˆ–è€…æ˜¯æ’å…¥å€¼ä¸ç¬¦åˆæ¡ä»¶,æ›´æ–°éƒ½ä¼šè¢«æ‹’ç».

##### äº‹åŠ¡

ç›¸å½“äºä¸€é¡¹ä½œä¸š,æ¯ä¸€ç¾¤SQLè¯­å¥ç»„æˆä¸€ä¸ªäº‹åŠ¡,å¯¹äºæ¯ä¸€ä¸ªäº‹åŠ¡è€Œè¨€.ä¸€æ¡è¯­å¥è¢«æ‰§è¡Œ,å°±æ„å‘³ç€å…³äºè¿™æ¡è¯­å¥çš„äº‹ç‰©è¢«ç»“æŸ.å¯¹äºä¸€ä¸ªäº‹åŠ¡çš„ç»“æŸ,æˆ‘ä»¬æœ‰ä¸¤ç§å¤„ç†åŠæ³•.

+ `commit work`:æäº¤å½“å‰äº‹åŠ¡,ç›¸å½“äºä¿å­˜æ‰€æœ‰æ›´æ”¹è‡³æ•°æ®åº“.ä¹‹åæ— æ³•å†æ›´æ”¹äº†
+ `rollback work`:å›æ»šå½“å‰äº‹åŠ¡,ç›¸å½“äºæ’¤é”€è¿™ä¸€æ­¥æ“ä½œ

å›æ»šè¿™æ ·çš„æ“ä½œ,æœ‰åˆ©äºä¿è¯æ•°æ®åº“åœ¨åˆ†å¸ƒå¼å‚¨å­˜çš„æƒ…å†µä¸‹,é¢å¯¹æ„å¤–å¯ä»¥æ›´å¥½åœ°ä¿è¯å¤šå¤„å­˜å‚¨ä¸­å¿ƒçš„æ•°æ®åŒæ­¥.

é»˜è®¤æƒ…å†µä¸‹,sqlè¯­å¥è‡ªåŠ¨æäº¤å’Œä¿å­˜,ä¹Ÿå¯ä»¥è¢«å…³é—­è¿™ä¸€é¡¹è®¾ç½®.å¯ä»¥ä½¿ç”¨`begin atomic .... end`çš„è¯­å¥æ¥æ¡†ä¸€ç¾¤è¯­å¥ä¸ºä¸€ä¸ªå•ä¸€äº‹åŠ¡.

#### å®Œæ•´æ€§çº¦æŸ

+ å®Œæ•´æ€§çº¦æŸä¿è¯æˆæƒç”¨æˆ·å¯¹äºæ•°æ®åº“çš„ä¿®æ”¹ä¸ä¼šç ´åä¸€è‡´æ€§,é˜²æ­¢æ•°æ®è¢«æ„å¤–ç ´å.

+ è¿™æ ·çš„å®Œæ•´æ€§çº¦æŸç›¸å½“äºä¸€ç§è®¾è®¡å¥½çš„æ•°æ®æ£€éªŒç¨‹åº.è¿™æ ·çš„ä¸€æ®µä»£ç ,å¯ä»¥åœ¨åˆ›å»ºå…³ç³»æ—¶å€™ä½œä¸º`create table `çš„ä¸€éƒ¨åˆ†è¢«æ‰§è¡Œ,ä¹Ÿå¯ä»¥åœ¨åé¢ä½¿ç”¨ `alter table TableName add Constraint`è¿™æ ·çš„è¯­å¥æ·»åŠ .

+ è¿™æ ·çš„å¯èƒ½å­˜åœ¨çš„æ–½åŠ é™åˆ¶æ¡ä»¶ä¸€èˆ¬æœ‰:

    + éç©ºå€¼çš„é™å®š `not null`

        ```sql
        Declare name and budget to be not null
        
        â€“name varchar (20) not null
        
        â€“budget numeric (12,2) not null
        ```

    + ä¸»é”®çš„é™åˆ¶ `primary key`

        ```sql
        primary key()
        ```

    + æ•°æ®äº’å¼‚æ€§çº¦æŸ`unique`

        ```sql
        unique ( A1 , A2 , â€¦, Am)
        ```

        ç”Ÿå‘½å¯ä»¥ä¿è¯è¿™ä¸€æ’æ‰€åˆ—å‡ºçš„å±æ€§æ„æˆä¸€ä¸ªè¶…ç ,æ—¢å…ƒç»„ä¹‹é—´ä¸èƒ½é‡å¤.

    + ==æ•°æ®ç‰¹æ®Šæ€§`check (Conditions)`==

        ```sql
        check(budget >0)
        check(season in ('summer','winter','spring','fall'))
        ```

        checkè¯­å¥è¢«ç”¨åœ¨å»ºè¡¨æ—¶,ä¿è¯æœ€åå¯¹äºå…ƒæ•°æ®è¿›è¡Œé™åˆ¶.

#### å‚ç…§å®Œæ•´æ€§

ç¡®ä¿åœ¨ç»™å®šçš„ä¸€ç»„å±æ€§ä¸­å‡ºç°åœ¨ä¸€ä¸ªå…³ç³»ä¸­çš„å€¼åœ¨å¦ä¸€ä¸ªå…³ç³»ä¸­çš„æŸäº›å±æ€§ä¸­ä¹Ÿå‡ºç°ã€‚

```sql
Example: If â€œBiologyâ€ is a department name
appearing in one of the tuples in the courserelation, then there exists a tuple in the department relation for â€œBiologyâ€. foreign key


create table course (
	course_id char (5) primary key
	title varchar (20)
	dept_name varchar (20) references department
 )
```

å¦‚æœæ‰§æ„è¦ä¿è¯æ›´æ”¹çš„æ­£ç¡®æ€§ å¯ä»¥ä½¿ç”¨`çº§è”`çš„æ–¹å¼æ¥åŒæ­¥æ›´æ–°æ‰€æœ‰çš„ã€‚ä¸‹é¢æ˜¯æ ‡å‡†çš„å®Œæ•´æ€§çº¦æŸå®šä¹‰ã€‚

```sql
create table course (
. . .
    dept_name varchar (20)
	foreign key (dept_name) references department on delete cascade
on update cascade,
. . .
)  //set null ,å¯ä»¥ä½¿å¦‚æœè¿ååˆ™è®¾é”™è¯¯çš„å±æ€§ä¸ºç©ºå€¼
   //set default å¯ä»¥è®¾è¿åè§„åˆ™çš„å€¼ä¸ºé»˜è®¤å€¼
```

**å¦‚æœå¯¹äºå®Œæ•´æ€§çº¦æŸä¸å¾—ä¸æš‚æ—¶æ€§è¿å**

```sql
E.g. create table person (
				ID char (10) primary key
				name char (40)
            	spouse char (10)
				foreign key couple references person)
	)
How to insert a tuple without causing constraint violation ?
åœ¨æ›´æ–°IDçš„æ—¶å€™ä¼šæ”¶åˆ°å¤–ç çš„é™åˆ¶ï¼Œä½†æ˜¯ä¸å¾—ä¸æ›´æ–°ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ
```

coupleæ˜¯ä¸€å¯¹çš„ï¼Œå½¼æ­¤äº’ç›¸ä¸ºå¯¹æ–¹çš„é…å¶ã€‚è¿™æ ·è¦æ˜¯ç¬¬ä¸€ä¸ªæ·»åŠ çš„æ—¶å€™ï¼Œä¼šæŠ¥é”™ï¼Œä½†æ˜¯ç¬¬äºŒä¸ªæ·»åŠ å®Œå°±æ­£ç¡®äº†ã€‚è¿™æ ·çš„è¯ï¼Œä¼šä½¿ç”¨ `initially deferred`æ¥ä¿è¯æ•´ä½“çš„æ£€æŸ¥æ˜¯åœ¨æœ€æœ«å°¾ï¼Œè€Œä¸æ˜¯æ‰§è¡Œä¸€å¥æ£€æŸ¥ä¸€å¥ã€‚

**å¯¹äºå¤æ‚çš„checkæ¡ä»¶ç›®å‰ä¸è¢«æ‰€æœ‰çš„æ•°æ®åº“æ”¯æŒ**ï¼Œå¯ä»¥åŠ ä¸Šä¸€æ®µè¯æ¥ä¿è¯ï¼Œä¾‹å¦‚ï¼š

```sql
check (time_slot_id inï¼ˆselect time_slot_id from time_slot) ï¼‰
```

è¿™æ®µä»£ç å°±è¯´ä¸ä»…è¦åœ¨æ’å…¥ä¿®æ”¹æ—¶æ£€æŸ¥ï¼Œä¹Ÿè¦åœ¨å…ƒç»„å…³ç³»è¢«ä¿®æ”¹æ—¶æ£€æŸ¥

#### æ–­è¨€

æ–­è¨€å°±æ˜¯ä¸€ä¸ªè°“è¯ï¼Œæˆ‘ä»¬ä¸Šæ–‡æ‰€è¯´çš„æ‰€æœ‰çº¦æŸæ¡ä»¶éƒ½æ˜¯æ–­è¨€ã€‚æ–­è¨€æ­£å¼è¢«å†™ä½œï¼š

```sql
create assertion <assertion name> check <predicate>
```

```sql
E.g. The value of the attribute tot_cred for each student must equal the sum of credits of courses that the student has completed successfully.

create assertion credits_earned_constraint check
	(not exists (select ID from student
			where tot_cred < >ï¼ˆ
				select sum(credits) 
                from takes join course
				on takes.course_id = course.course_id
                where student.ID = takes.ID and grade is not null and grade < > â€˜Fâ€™)
     //æ£€æŸ¥äº†å­¦ç”Ÿä¸æŒ‚ç§‘ï¼Œå¹¶ä¸”ä¿è¯æ‰€é€‰è¯¾ç¨‹ä¸è®°å½•çš„ä¸€è‡´
```

#### é™„åŠ çš„ç»ƒä¹ ç”¨è§†é¢‘ç½‘ç«™

>https://www.bilibili.com/video/BV1P5411e7rU?p=10
>
>https://www.bilibili.com/video/BV1ct411G78W?from=search&seid=2232511821826680259
>
>https://search.bilibili.com/all?keyword=SQL%E8%AF%AD%E5%8F%A5&from_source=nav_suggest_new



 				

